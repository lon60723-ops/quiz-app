<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>成績分析</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            padding: 2em;
            max-width: 700px;
            margin: 0 auto;
            background-color: #fcfcfc;
        }
        .header {
            text-align: right; font-size: 0.9em; color: #666;
        }
        .header b { color: #039393; }
        h1 { color: #039393; }
        h2 { border-bottom: 2px solid #039393; padding-bottom: 5px; }
        .summary-box {
            display: flex;
            justify-content: space-around;
            text-align: center;
            background-color: white;
            padding: 1.5em;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin: 2em 0;
        }
        .summary-box div p { margin: 0; font-size: 0.9em; color: #666; }
        .summary-box div .data {
            font-size: 1.8em;
            font-weight: 700;
            color: #039393;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1em;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        thead tr { background-color: #f9f9f9; }
        tbody tr:last-child td { border-bottom: none; }
        td.percent { text-align: right; font-weight: 600; color: #039393; }
        td.count { text-align: right; color: #666; }
        .home-link {
            display: inline-block;
            margin-top: 2em;
            color: #666;
        }
    </style>
</head>
<body>
    <p class="header">ようこそ、 <b>{{ username }}</b> さん</p>
    <h1>あなたの成績分析</h1>

    <hr style="border:0; border-top: 1px solid #f0f0f0;">

    <h2>総合（サマリー）</h2>
    <div class="summary-box">
        <div>
            <p>総解答数</p>
            <span class="data">{{ total_attempts }}</span>
        </div>
        <div>
            <p>正解数</p>
            <span class="data">{{ total_correct }}</span>
        </div>
        <div>
            <p>総合正解率</p>
            <span class="data">{{ overall_accuracy | round(1) }} %</span>
        </div>
    </div>

    <hr style="border:0; border-top: 1px solid #f0f0f0;">

    <h2>得意分野と強化可能な分野</h2>

    {% if chart_url %}
        <div style="margin: 20px 0; background-color: white; padding: 1em; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
            <img src="{{ chart_url }}" alt="成績分析グラフ" style="width: 100%; max-width: 700px; height: auto;">
        </div>
    {% endif %}

    <p style="font-size: 0.9em; color: #666;">（カテゴリ別の正解率 データ表）</p>

    {% if category_stats is not none and not category_stats.empty %}
        <table>
            <thead>
                <tr>
                    <th>カテゴリ</th>
                    <th>正解率 (%)</th>
                    <th>解答数</th>
                </tr>
            </thead>
            <tbody>
                {% for index, row in category_stats.iterrows() %}
                    <tr>
                        <td>{{ row['カテゴリ'] }}</td>
                        <td class="percent">{{ (row['正解率'] * 100) | round(1) }}</td>
                        <td class="count">{{ row['解答数'] }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>まだ十分な解答データがありません。クイズを解いてください。</p>
    {% endif %}

    <br>
    <a href="/" class="home-link">ホームに戻る</a>
</body>
</html>
